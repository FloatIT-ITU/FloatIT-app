# FloatIT - ITU

FloatIT is a Progressive Web App (PWA) designed for managing the ITU (IT University of Copenhagen) swimming club activities. Built with Flutter for web, it provides event management, attendance tracking, and member coordination features.

## Features

- **Microsoft Authentication**: Login with ITU (`@itu.dk`) accounts using Azure AD OAuth
- **Event Management**: Create, edit, and manage swimming practice sessions, competitions, and social events
- **Attendance Tracking**: First-come-first-serve event signup with waiting lists
- **Rate Limiting**: Built-in spam protection for all user actions
- **Pool Status**: Real-time status updates for Sundby Bad swimming facility
- **Admin Controls**: Event management, user administration, and notification system
- **Responsive Design**: Works on desktop and mobile browsers

## Tech Stack

- **Frontend**: Flutter 3.24.3+ (Web)
- **Backend**: Firebase (Authentication, Firestore Database)
- **Hosting**: GitHub Pages
- **Authentication**: Microsoft OAuth 2.0 (Azure AD)
- **CI/CD**: GitHub Actions

## Notifications

The app supports push notifications via Firebase Cloud Messaging (FCM) for web and mobile. Global notifications are sent when admins create them through the admin panel, triggering a GitHub Actions workflow that sends FCM pushes to all registered users.

- Admins create notifications via the admin panel.
- Notifications are stored in Firestore `notifications` collection.
- GitHub Actions workflow sends FCM pushes using a service account.
- Users receive pushes if they have enabled notifications and registered FCM tokens.

## Prerequisites

- Flutter SDK 3.24.3 or higher
- Firebase project (Spark/Free tier compatible)
- Azure AD app registration for Microsoft OAuth
- GitHub account with Pages enabled

## Local Development Setup

### 1. Clone the Repository

```bash
git clone https://github.com/FloatIT-ITU/FloatIT-app.git
cd FloatIT-app
```
    
### 2. Install Dependencies

```bash
flutter pub get
```

### 3. Run Locally

For development with production Firebase (required for Microsoft OAuth):

```bash
flutter run -d chrome
```

To use Firebase emulators for other features:

1. Uncomment the emulator code in `lib/main.dart`
2. Start emulators: `firebase emulators:start`
3. Run the app

## Deployment

### GitHub Pages Deployment

The app automatically deploys to GitHub Pages when changes are pushed to `main` branch.

**Manual deployment:**

```bash
# Build for production
flutter build web --release

# Deploy
# GitHub Actions handles this
```

### Configuration for GitHub Pages

1. Go to repository **Settings** → **Pages**
2. Set source to **GitHub Actions**
3. Ensure workflow permissions allow write access

## Project Structure

```
lib/
├── main.dart                      # App entry point
├── firebase_options.dart          # Firebase configuration
└── src/
    ├── app.dart                   # Main app widget
    ├── auth_gate.dart             # Authentication flow
    ├── microsoft_auth_service.dart # Microsoft OAuth handler
    ├── event_details_page.dart    # Event management
    ├── user_profile_provider.dart # User state management
    ├── services/
    │   ├── rate_limit_service.dart # Spam protection
    │   └── firebase_service.dart   # Firestore helpers
    └── widgets/                    # Reusable UI components
```

## Firebase Configuration

### Firestore Collections

- `users/{userId}` - Private user data (email, admin status)
- `public_users/{userId}` - Public profile (displayName, occupation, iconColor)
- `events/{eventId}` - Event details with attendees and waiting lists
- `join_requests` - Pending event join/leave requests
- `templates` - Recurring event templates
- `app/global_banner` - Global notification banner

### Authentication

- **Provider**: Microsoft (Azure AD)
- **Domain Restriction**: Only `@itu.dk` emails

## Environment Variables

No environment variables needed for basic operation. All configuration is in:
- `lib/firebase_options.dart` (generated by FlutterFire CLI)
- Firebase Console settings
- Azure AD App Registration settings

## Contributing

1. Create a feature branch from `main`
2. Make your changes
3. Run `flutter analyze` to ensure no issues
4. Test locally
5. Submit a pull request to `main`
6. After review and approval, your changes will be merged and deployed

## Support

For issues or questions, please open an issue on GitHub or contact the FloatIT members.